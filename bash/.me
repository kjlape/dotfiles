# vim:set ft=sh:

export CLICOLOR=1
export EDITOR=vim
export XDG_CONFIG_HOME="$HOME/.config"
export RIPGREP_CONFIG_PATH="$XDG_CONFIG_HOME/ripgrep/.ripgreprc"
export HISTSIZE=100000
export HISTFILESIZE=1000000

export GIT_USER=pingortle
export DEV="$HOME/dev"
export MYDEV="$DEV/$GIT_USER"
export DOTFILES="$MYDEV/dotfiles"
export ICLOUD_DIR="~/Library/Mobile Documents/com~apple~CloudDocs"

export HUSKY_SKIP_INSTALL=1 # whyyy would anyone opt into slow commits???
export HUSKY_SKIP_HOOKS=1

eval "$(git run --bash-complete)"

source /usr/local/etc/bash_completion.d/git-completion.bash
source /usr/local/etc/bash_completion.d/git-prompt.sh

[ -f $HOME/.secrets ] && source $HOME/.secrets
source $HOME/.colors

alias diff="git diff --no-index"
alias trim='tr -d "\n"'
alias rebash="source ~/.me"
alias screencast='PS1="$SCREENCAST_PS1"'
alias v=vim
alias vs='vim -S $(git dotgit | trim)/.vim-sessions/$(git rev-parse --abbrev-ref HEAD | trim).vim'
alias mvims='mvim -S $(git dotgit | trim)/.vim-sessions/$(git rev-parse --abbrev-ref HEAD | trim).vim'
alias til="vim \"$MYDEV/til\" +'cd %:p:h' +TIL"
alias tpbc='tmux saveb - | pbcopy'
alias tmux-here='tmux new -s "$(basename $(pwd))" -c $(pwd)'
alias ssh='TERM=xterm-256color ssh'
alias toggle-dark="osascript -e 'tell app \"System Events\" to tell appearance preferences to set dark mode to not dark mode'"
alias browse-node-docs="open https://nodejs.org/dist/latest/docs/api/"
alias mdlive="npx --quiet markdown-live"
alias whatsmyip="curl https://api.ipify.org"
alias kitty="/Applications/kitty.app/Contents/MacOS/kitty"
alias page='printf "%$(tput cols)s" "" | tr " " "â—¦"; echo'
alias hr=page
alias oven='cd ~/dev/pingortle/oven'
alias c-icloud='cd "$ICLOUD_DIR"'
alias gemfile-me='echo "source \"https://rubygems.org\"" > Gemfile'

alias la="ls -a"
alias be="bundle exec"
alias breadme="bat README.md"
alias select-history='$(history | selecta | sed "s/^ *[0-9]* *//g")'
alias frazzled='vim ~/.frazzle-dazzle.md'
alias defrazzle='bat ~/.frazzle-dazzle.md'

editor() {
  export EDITOR="$1"
}

function vrg {
  $EDITOR +"Rg '$*'"
}

function prg {
  rg -p "$@" | less -RMFXK
}

function srg {
  prg -g '!test' "$@"
}

dev() {
  find ~/dev -maxdepth 2 -depth 2 | fzf --query "$@"
}

my() {
  find ~/dev/$GIT_USER -type d -maxdepth 1 -depth 1 | fzf --query "$@"
}

cdev() {
  cd "$(dev "$@")"
}

cmy() {
  cd "$(my "$@")"
}

function set-terminal-app-profile {
  osascript -e \
    "tell app \"Terminal\" to set current settings of first window to settings set \"$1\""
}

function good-night {
  terminal-profile Basic
  macos-appearance dark
  printf dark > ~/.dev-mood
  export DEV_MOOD=dark
  run-all-app-windows MacVim ":ReloadMood"
}

function good-morning {
  terminal-profile Basic
  macos-appearance light
  printf light > ~/.dev-mood
  export DEV_MOOD=light
}

function visualize {
  ffmpeg -i $1 \
    -filter_complex "[0:a]showwaves=s=4096x2160:mode=cline,format=yuv420p[v]" \
    -map "[v]" \
    -map 0:a \
    $2
}
